)
)%>%
mutate(Country=if_else(Country=="Dominican Republic","Dominican",Country))
# Required libraries
library(stringr)
library(readxl)
library(dplyr)
library(lubridate)
library(googledrive)
library(tidyr)
library(writexl)
# Authenticate with Google
drive_auth()
# Read your Excel file
data_1 <- read_excel("D:/Naser/Shiny & Power BI/Editted data/data 03.01.2026.xlsx")
# List of product names
product_list <- c(
"AryoSeven", "Altebrel", "ReciGen", "CinnoVex", "Pectuna", "CinnaTropin", "Perfacto","Arylia","Zak Aria",
"Zytux", "Melitide", "AryoTrust", "Stivant", "PegaGen", "ZakAria", "CinnoMer","Beta Erythropoietin","Artenix",
"CinnoRA", "CinnaTropin", "Cinnal-f", "CinnoPar", "Cinnapoietin", "Temziva","Ovutropin",
"Xtramab","Spartina","Maciza"
)
# Assume first column is sentences
sentences <- data_1[[1]]
# Extract product name(s)
extract_products <- function(text, products) {
matches <- products[str_detect(tolower(text), tolower(products))]
if(length(matches) > 0) paste(unique(matches), collapse = ", ") else NA
}
# Extract dosage(s) (e.g., "1 mg", "50 mg", "4000 mg", etc.)
extract_dosage <- function(text) {
match <- str_extract(text, "\\b\\d+\\.?\\d*\\s?(mg|g|mcg|µg|ml|IU|units)\\b")
if(!is.na(match)) match else NA
}
# Apply functions
data_1$ProductFound <- sapply(sentences, extract_products, products=product_list)
data_1$DosageFound <- sapply(sentences, extract_dosage)
eaeu_members <- c("Armenia", "Belarus", "Kazakhstan", "Kyrgyzstan", "Russia")
# Data transformation and cleaning
data_1 <- data_1 %>%
select(ProductFound, DosageFound, Company, Country, `Registration date-Gregorian`,
`Registration date-Solar`, `Expiry date-Gregorian`, `Expiry date-Solar`,
PharmaceuticalForm, Presentation,Product) %>%
rename(P=Product,Product = ProductFound, Dosage = DosageFound) %>%
mutate(
Product = if_else(Product == "Zak Aria", "ZakAria", Product),
Product = if_else(Product == "Beta Erythropoietin", "Cinnapoietin", Product),
Product = if_else(Product == "Ovutropin", "Cinnal-f", Product),
Product = if_else(Product == "Perfacto", "AryoSeven", Product)
) %>%
filter(Company != "نانو الوند") %>%
mutate(id=row_number())%>%
group_by(Product, Dosage, Company, Country) %>%
arrange(`Registration date-Gregorian`) %>%
mutate(Project_Status = ifelse(row_number() == 1, "new", "re-registration")) %>%
ungroup() %>%
rename(
Registration_date_Gregorian = `Registration date-Gregorian`,
Registration_date_Solar = `Registration date-Solar`,
Expiry_date_Gregorian = `Expiry date-Gregorian`,
Expiry_date_Solar = `Expiry date-Solar`,
Medicine = Product,
Manufacturer = Company
) %>%
mutate(
Dosage = str_replace_all(Dosage, "(\\d)([A-Za-z])", "\\1 \\2"),
Manufacturer = if_else(Manufacturer == "سیناژن", "CinnaGen", "AryoGen")
) %>%
arrange(Medicine, Dosage, Manufacturer, Country, Registration_date_Gregorian) %>%
group_by(Medicine, Dosage, Manufacturer, Country) %>%
mutate(
next_registration = lead(Registration_date_Gregorian),
calculated_expiry = if_else(
!is.na(next_registration),
make_date(year(next_registration) - 1, 12, 31),
NA_Date_
),
Expiry_date_Gregorian = if_else(
is.na(Expiry_date_Gregorian),
calculated_expiry,
Expiry_date_Gregorian
)
) %>%
ungroup() %>%
select(-next_registration, -calculated_expiry) %>%
mutate(Expiry_date_Gregorian = ymd(paste0(year(Expiry_date_Gregorian),"-",
month(Expiry_date_Gregorian),"-",
day(Expiry_date_Gregorian))),
Registration_date_Gregorian = ymd(paste0(year(Registration_date_Gregorian),"-",
month(Registration_date_Gregorian),"-",
day(Registration_date_Gregorian))),
Expiration_status = if_else(!is.na(Expiry_date_Gregorian),if_else(Expiry_date_Gregorian < today(),
"Expired", "Not expired"),"Not expired"),
Start = year(Registration_date_Gregorian),
Finish = year(Expiry_date_Gregorian),
Finish = if_else(is.na(Finish), year(Sys.Date()) + 2, Finish)
) %>%
mutate(Finish = ifelse(is.na(Finish), Start, Finish)) %>%
mutate(
Country = if_else(
Country == "EAEU",
paste(eaeu_members, collapse = ","),  # temporary marker
Country
)
)%>%
mutate(Country=if_else(Country=="Dominican Republic","Dominican",Country))
data=data_1%>%
separate_rows(Country, sep = ",")%>%
rowwise() %>%
mutate(Gregorian_year = list(Start:Finish)) %>%
unnest(Gregorian_year) %>% ungroup() %>%
distinct(
Medicine,
Manufacturer,
Country,
Gregorian_year,
Dosage,
.keep_all = TRUE
)
# Save locally as temporary CSV
temp_csv <- tempfile(fileext = ".csv")
write.csv(data, temp_csv, row.names = FALSE)
# Upload to Google Sheets and replace existing content
# First, get the file
sheet_file <- drive_get(as_id("13EYwvmP5uWQP_movX4vITdj8KtP6RiRi0WhNfJiXjVA"))
# Update the file with new data
drive_update(
file = sheet_file,
media = temp_csv
)
# Clean up temporary file
unlink(temp_csv)
# Save to Excel file
write_xlsx(data, "D:/Naser/Shiny & Power BI/Editted data/MA approval.xlsx")
# Save locally as temporary CSV
temp_csv <- tempfile(fileext = ".csv")
write.csv(data_1, temp_csv, row.names = FALSE)
sheet_file_raw <- drive_get(as_id("1q95ePu8dSSw2jq_0EC8I3iKOLJUcesyMM476eheVUn8"))
drive_update(
file = sheet_file_raw,
media = temp_csv
)
unlink(temp_csv)
#
#
# # Save locally as temporary CSV
View(data)
g=unique(data$id)
g
g=sort(unique(data$id))
g
View(data)
# Required libraries
library(stringr)
library(readxl)
library(dplyr)
library(lubridate)
library(googledrive)
library(tidyr)
library(writexl)
# Authenticate with Google
drive_auth()
# Read your Excel file
data_1 <- read_excel("D:/Naser/Shiny & Power BI/Editted data/data 03.01.2026.xlsx")
# List of product names
product_list <- c(
"AryoSeven", "Altebrel", "ReciGen", "CinnoVex", "Pectuna", "CinnaTropin", "Perfacto","Arylia","Zak Aria",
"Zytux", "Melitide", "AryoTrust", "Stivant", "PegaGen", "ZakAria", "CinnoMer","Beta Erythropoietin","Artenix",
"CinnoRA", "CinnaTropin", "Cinnal-f", "CinnoPar", "Cinnapoietin", "Temziva","Ovutropin",
"Xtramab","Spartina","Maciza"
)
# Assume first column is sentences
sentences <- data_1[[1]]
# Extract product name(s)
extract_products <- function(text, products) {
matches <- products[str_detect(tolower(text), tolower(products))]
if(length(matches) > 0) paste(unique(matches), collapse = ", ") else NA
}
# Extract dosage(s) (e.g., "1 mg", "50 mg", "4000 mg", etc.)
extract_dosage <- function(text) {
match <- str_extract(text, "\\b\\d+\\.?\\d*\\s?(mg|g|mcg|µg|ml|IU|units)\\b")
if(!is.na(match)) match else NA
}
# Apply functions
data_1$ProductFound <- sapply(sentences, extract_products, products=product_list)
data_1$DosageFound <- sapply(sentences, extract_dosage)
eaeu_members <- c("Armenia", "Belarus", "Kazakhstan", "Kyrgyzstan", "Russia")
# Data transformation and cleaning
data_1 <- data_1 %>%
select(ProductFound, DosageFound, Company, Country, `Registration date-Gregorian`,
`Registration date-Solar`, `Expiry date-Gregorian`, `Expiry date-Solar`,
PharmaceuticalForm, Presentation,Product) %>%
rename(P=Product,Product = ProductFound, Dosage = DosageFound) %>%
mutate(
Product = if_else(Product == "Zak Aria", "ZakAria", Product),
Product = if_else(Product == "Beta Erythropoietin", "Cinnapoietin", Product),
Product = if_else(Product == "Ovutropin", "Cinnal-f", Product),
Product = if_else(Product == "Perfacto", "AryoSeven", Product)
) %>%
filter(Company != "نانو الوند") %>%
mutate(id=row_number())%>%
group_by(Product, Dosage, Company, Country) %>%
arrange(`Registration date-Gregorian`) %>%
mutate(Project_Status = ifelse(row_number() == 1, "new", "re-registration")) %>%
ungroup() %>%
rename(
Registration_date_Gregorian = `Registration date-Gregorian`,
Registration_date_Solar = `Registration date-Solar`,
Expiry_date_Gregorian = `Expiry date-Gregorian`,
Expiry_date_Solar = `Expiry date-Solar`,
Medicine = Product,
Manufacturer = Company
) %>%
mutate(
Dosage = str_replace_all(Dosage, "(\\d)([A-Za-z])", "\\1 \\2"),
Manufacturer = if_else(Manufacturer == "سیناژن", "CinnaGen", "AryoGen")
) %>%
arrange(Medicine, Dosage, Manufacturer, Country, Registration_date_Gregorian) %>%
group_by(Medicine, Dosage, Manufacturer, Country) %>%
mutate(
next_registration = lead(Registration_date_Gregorian),
calculated_expiry = if_else(
!is.na(next_registration),
make_date(year(next_registration) - 1, 12, 31),
NA_Date_
),
Expiry_date_Gregorian = if_else(
is.na(Expiry_date_Gregorian),
calculated_expiry,
Expiry_date_Gregorian
)
) %>%
ungroup() %>%
select(-next_registration, -calculated_expiry) %>%
mutate(Expiry_date_Gregorian = ymd(paste0(year(Expiry_date_Gregorian),"-",
month(Expiry_date_Gregorian),"-",
day(Expiry_date_Gregorian))),
Registration_date_Gregorian = ymd(paste0(year(Registration_date_Gregorian),"-",
month(Registration_date_Gregorian),"-",
day(Registration_date_Gregorian))),
Expiration_status = if_else(!is.na(Expiry_date_Gregorian),if_else(Expiry_date_Gregorian < today(),
"Expired", "Not expired"),"Not expired"),
Start = year(Registration_date_Gregorian),
Finish = year(Expiry_date_Gregorian),
Finish = if_else(is.na(Finish), year(Sys.Date()) + 2, Finish)
) %>%
mutate(Finish = ifelse(is.na(Finish), Start, Finish)) %>%
mutate(
Country = if_else(
Country == "EAEU",
paste(eaeu_members, collapse = ","),  # temporary marker
Country
)
)%>%
mutate(Country=if_else(Country=="Dominican Republic","Dominican",Country))
# Required libraries
library(stringr)
library(readxl)
library(dplyr)
library(lubridate)
library(googledrive)
library(tidyr)
library(writexl)
# Authenticate with Google
drive_auth()
# Read your Excel file
data_1 <- read_excel("D:/Naser/Shiny & Power BI/Editted data/data 03.01.2026.xlsx")
# List of product names
product_list <- c(
"AryoSeven", "Altebrel", "ReciGen", "CinnoVex", "Pectuna", "CinnaTropin", "Perfacto","Arylia","Zak Aria",
"Zytux", "Melitide", "AryoTrust", "Stivant", "PegaGen", "ZakAria", "CinnoMer","Beta Erythropoietin","Artenix",
"CinnoRA", "CinnaTropin", "Cinnal-f", "CinnoPar", "Cinnapoietin", "Temziva","Ovutropin",
"Xtramab","Spartina","Maciza"
)
# Assume first column is sentences
sentences <- data_1[[1]]
# Extract product name(s)
extract_products <- function(text, products) {
matches <- products[str_detect(tolower(text), tolower(products))]
if(length(matches) > 0) paste(unique(matches), collapse = ", ") else NA
}
# Extract dosage(s) (e.g., "1 mg", "50 mg", "4000 mg", etc.)
extract_dosage <- function(text) {
match <- str_extract(text, "\\b\\d+\\.?\\d*\\s?(mg|g|mcg|µg|ml|IU|units)\\b")
if(!is.na(match)) match else NA
}
# Apply functions
data_1$ProductFound <- sapply(sentences, extract_products, products=product_list)
data_1$DosageFound <- sapply(sentences, extract_dosage)
eaeu_members <- c("Armenia", "Belarus", "Kazakhstan", "Kyrgyzstan", "Russia")
# Data transformation and cleaning
data_1 <- data_1 %>%
select(ProductFound, DosageFound, Company, Country, `Registration date-Gregorian`,
`Registration date-Solar`, `Expiry date-Gregorian`, `Expiry date-Solar`,
PharmaceuticalForm, Presentation,Product) %>%
rename(P=Product,Product = ProductFound, Dosage = DosageFound) %>%
mutate(
Product = if_else(Product == "Zak Aria", "ZakAria", Product),
Product = if_else(Product == "Beta Erythropoietin", "Cinnapoietin", Product),
Product = if_else(Product == "Ovutropin", "Cinnal-f", Product),
Product = if_else(Product == "Perfacto", "AryoSeven", Product)
) %>%
filter(Company != "نانو الوند") %>%
mutate(id=row_number())%>%
group_by(Product, Dosage, Company, Country) %>%
arrange(`Registration date-Gregorian`) %>%
mutate(Project_Status = ifelse(row_number() == 1, "new", "re-registration")) %>%
ungroup() %>%
rename(
Registration_date_Gregorian = `Registration date-Gregorian`,
Registration_date_Solar = `Registration date-Solar`,
Expiry_date_Gregorian = `Expiry date-Gregorian`,
Expiry_date_Solar = `Expiry date-Solar`,
Medicine = Product,
Manufacturer = Company
) %>%
mutate(
Dosage = str_replace_all(Dosage, "(\\d)([A-Za-z])", "\\1 \\2"),
Manufacturer = if_else(Manufacturer == "سیناژن", "CinnaGen", "AryoGen")
) %>%
arrange(Medicine, Dosage, Manufacturer, Country, Registration_date_Gregorian) %>%
group_by(Medicine, Dosage, Manufacturer, Country) %>%
mutate(
next_registration = lead(Registration_date_Gregorian),
calculated_expiry = if_else(
!is.na(next_registration),
make_date(year(next_registration) - 1, 12, 31),
NA_Date_
),
Expiry_date_Gregorian = if_else(
is.na(Expiry_date_Gregorian),
calculated_expiry,
Expiry_date_Gregorian
)
) %>%
ungroup() %>%
select(-next_registration, -calculated_expiry) %>%
mutate(Expiry_date_Gregorian = ymd(paste0(year(Expiry_date_Gregorian),"-",
month(Expiry_date_Gregorian),"-",
day(Expiry_date_Gregorian))),
Registration_date_Gregorian = ymd(paste0(year(Registration_date_Gregorian),"-",
month(Registration_date_Gregorian),"-",
day(Registration_date_Gregorian))),
Expiration_status = if_else(!is.na(Expiry_date_Gregorian),if_else(Expiry_date_Gregorian < today(),
"Expired", "Not expired"),"Not expired"),
Start = year(Registration_date_Gregorian),
Finish = year(Expiry_date_Gregorian),
Finish = if_else(is.na(Finish), year(Sys.Date()) + 2, Finish)
) %>%
mutate(Finish = ifelse(is.na(Finish), Start, Finish)) %>%
mutate(
Country = if_else(
Country == "EAEU",
paste(eaeu_members, collapse = ","),  # temporary marker
Country
)
)%>%
mutate(Country=if_else(Country=="Dominican Republic","Dominican",Country))
data=data_1%>%
separate_rows(Country, sep = ",")%>%
rowwise() %>%
mutate(Gregorian_year = list(Start:Finish)) %>%
unnest(Gregorian_year) %>% ungroup()
source("D:/Naser/reffrence code/Extract produxt name.R", echo = TRUE)
# Required libraries
library(stringr)
library(readxl)
library(dplyr)
library(lubridate)
library(googledrive)
library(tidyr)
library(writexl)
# Authenticate with Google
drive_auth()
# Read your Excel file
data_1 <- read_excel("D:/Naser/Shiny & Power BI/Editted data/data 03.01.2026.xlsx")
# List of product names
product_list <- c(
"AryoSeven", "Altebrel", "ReciGen", "CinnoVex", "Pectuna", "CinnaTropin", "Perfacto","Arylia","Zak Aria",
"Zytux", "Melitide", "AryoTrust", "Stivant", "PegaGen", "ZakAria", "CinnoMer","Beta Erythropoietin","Artenix",
"CinnoRA", "CinnaTropin", "Cinnal-f", "CinnoPar", "Cinnapoietin", "Temziva","Ovutropin",
"Xtramab","Spartina","Maciza"
)
# Assume first column is sentences
sentences <- data_1[[1]]
# Extract product name(s)
extract_products <- function(text, products) {
matches <- products[str_detect(tolower(text), tolower(products))]
if(length(matches) > 0) paste(unique(matches), collapse = ", ") else NA
}
# Extract dosage(s) (e.g., "1 mg", "50 mg", "4000 mg", etc.)
extract_dosage <- function(text) {
match <- str_extract(text, "\\b\\d+\\.?\\d*\\s?(mg|g|mcg|µg|ml|IU|units)\\b")
if(!is.na(match)) match else NA
}
# Apply functions
data_1$ProductFound <- sapply(sentences, extract_products, products=product_list)
data_1$DosageFound <- sapply(sentences, extract_dosage)
eaeu_members <- c("Armenia", "Belarus", "Kazakhstan", "Kyrgyzstan", "Russia")
# Data transformation and cleaning
data_1 <- data_1 %>%
select(ProductFound, DosageFound, Company, Country, `Registration date-Gregorian`,
`Registration date-Solar`, `Expiry date-Gregorian`, `Expiry date-Solar`,
PharmaceuticalForm, Presentation,Product) %>%
rename(P=Product,Product = ProductFound, Dosage = DosageFound) %>%
mutate(
Product = if_else(Product == "Zak Aria", "ZakAria", Product),
Product = if_else(Product == "Beta Erythropoietin", "Cinnapoietin", Product),
Product = if_else(Product == "Ovutropin", "Cinnal-f", Product),
Product = if_else(Product == "Perfacto", "AryoSeven", Product)
) %>%
filter(Company != "نانو الوند") %>%
mutate(id=row_number())%>%
group_by(Product, Dosage, Company, Country) %>%
arrange(`Registration date-Gregorian`) %>%
mutate(Project_Status = ifelse(row_number() == 1, "new", "re-registration")) %>%
ungroup() %>%
rename(
Registration_date_Gregorian = `Registration date-Gregorian`,
Registration_date_Solar = `Registration date-Solar`,
Expiry_date_Gregorian = `Expiry date-Gregorian`,
Expiry_date_Solar = `Expiry date-Solar`,
Medicine = Product,
Manufacturer = Company
) %>%
mutate(
Dosage = str_replace_all(Dosage, "(\\d)([A-Za-z])", "\\1 \\2"),
Manufacturer = if_else(Manufacturer == "سیناژن", "CinnaGen", "AryoGen")
) %>%
arrange(Medicine, Dosage, Manufacturer, Country, Registration_date_Gregorian) %>%
group_by(Medicine, Dosage, Manufacturer, Country) %>%
mutate(
next_registration = lead(Registration_date_Gregorian),
calculated_expiry = if_else(
!is.na(next_registration),
make_date(year(next_registration) - 1, 12, 31),
NA_Date_
),
Expiry_date_Gregorian = if_else(
is.na(Expiry_date_Gregorian),
calculated_expiry,
Expiry_date_Gregorian
)
) %>%
ungroup() %>%
select(-next_registration, -calculated_expiry) %>%
mutate(Expiry_date_Gregorian = ymd(paste0(year(Expiry_date_Gregorian),"-",
month(Expiry_date_Gregorian),"-",
day(Expiry_date_Gregorian))),
Registration_date_Gregorian = ymd(paste0(year(Registration_date_Gregorian),"-",
month(Registration_date_Gregorian),"-",
day(Registration_date_Gregorian))),
Expiration_status = if_else(!is.na(Expiry_date_Gregorian),if_else(Expiry_date_Gregorian < today(),
"Expired", "Not expired"),"Not expired"),
Start = year(Registration_date_Gregorian),
Finish = year(Expiry_date_Gregorian),
Finish = if_else(is.na(Finish), year(Sys.Date()) + 2, Finish)
) %>%
mutate(Finish = ifelse(is.na(Finish), Start, Finish)) %>%
mutate(
Country = if_else(
Country == "EAEU",
paste(eaeu_members, collapse = ","),  # temporary marker
Country
)
)%>%
mutate(Country=if_else(Country=="Dominican Republic","Dominican",Country))
data=data_1%>%
separate_rows(Country, sep = ",")%>%
rowwise() %>%
mutate(Gregorian_year = list(Start:Finish)) %>%
unnest(Gregorian_year) %>% ungroup() %>%
distinct(
Medicine,
Manufacturer,
Country,
Gregorian_year,
Dosage,
.keep_all = TRUE
)
# Save locally as temporary CSV
temp_csv <- tempfile(fileext = ".csv")
write.csv(data, temp_csv, row.names = FALSE)
# Upload to Google Sheets and replace existing content
# First, get the file
sheet_file <- drive_get(as_id("13EYwvmP5uWQP_movX4vITdj8KtP6RiRi0WhNfJiXjVA"))
# Update the file with new data
drive_update(
file = sheet_file,
media = temp_csv
)
# Clean up temporary file
unlink(temp_csv)
# Save to Excel file
write_xlsx(data, "D:/Naser/Shiny & Power BI/Editted data/MA approval.xlsx")
# Save locally as temporary CSV
temp_csv <- tempfile(fileext = ".csv")
write.csv(data_1, temp_csv, row.names = FALSE)
sheet_file_raw <- drive_get(as_id("1q95ePu8dSSw2jq_0EC8I3iKOLJUcesyMM476eheVUn8"))
drive_update(
file = sheet_file_raw,
media = temp_csv
)
unlink(temp_csv)
f=data[1:200,]
g=sort(unique(f$id))
g
ff=data_1 %>% filter(id %in% g)
View(ff)
g
runApp()
runApp()
