mutate(Project_Status = ifelse(row_number() == 1, "new", "re-registration")) %>%
ungroup() %>%
rename(
Registration_date_Gregorian = `Registration date-Gregorian`,
Registration_date_Solar = `Registration date-Solar`,
Expiry_date_Gregorian = `Expiry date-Gregorian`,
Expiry_date_Solar = `Expiry date-Solar`,
Medicine = Product,
Manufacturer = Company
) %>%
mutate(
Dosage = str_replace_all(Dosage, "(\\d)([A-Za-z])", "\\1 \\2"),
Manufacturer = if_else(Manufacturer == "سیناژن", "CinnaGen", "AryoGen")
) %>%
arrange(Medicine, Dosage, Manufacturer, Country, Registration_date_Gregorian) %>%
group_by(Medicine, Dosage, Manufacturer, Country) %>%
mutate(
next_registration = lead(Registration_date_Gregorian),
calculated_expiry = if_else(
!is.na(next_registration),
make_date(year(next_registration) - 1, 12, 31),
NA_Date_
),
Expiry_date_Gregorian = if_else(
is.na(Expiry_date_Gregorian),
calculated_expiry,
Expiry_date_Gregorian
)
) %>%
ungroup() %>%
select(-next_registration, -calculated_expiry) %>%
mutate(
Start = year(Registration_date_Gregorian),
Finish = year(Expiry_date_Gregorian),
Finish = if_else(is.na(Finish), year(Sys.Date()) + 2, Finish)
) %>%
mutate(Finish = ifelse(is.na(Finish), Start, Finish)) %>%
mutate(
Country = if_else(
Country == "EAEU",
paste(eaeu_members, collapse = ","),  # temporary marker
Country
)
)
View(data_1)
data=data_1%>%
separate_rows(Country, sep = ",")%>%
rowwise() %>%
mutate(Gregorian_year = list(Start:Finish)) %>%
unnest(Gregorian_year) %>% ungroup() %>%
distinct(
Medicine,
Manufacturer,
Country,
Gregorian_year,
Dosage,
.keep_all = TRUE
)%>%
mutate(Country=if_else(Country=="Dominican Republic","Dominican",Country))
# Upload to Google Sheets and replace existing content
# First, get the file
sheet_file <- drive_get(as_id("1q95ePu8dSSw2jq_0EC8I3iKOLJUcesyMM476eheVUn8"))
# Required libraries
library(stringr)
library(readxl)
library(dplyr)
library(lubridate)
library(googledrive)
library(tidyr)
library(writexl)
# Authenticate with Google
drive_auth()
# Read your Excel file
data_1 <- read_excel("C:/Users/Ahmadina/Downloads/data.xlsx")
# List of product names
product_list <- c(
"AryoSeven", "Altebrel", "ReciGen", "CinnoVex", "Pectuna", "CinnaTropin", "Perfacto","Arylia","Zak Aria",
"Zytux", "Melitide", "AryoTrust", "Stivant", "PegaGen", "ZakAria", "CinnoMer","Beta Erythropoietin","Artenix",
"CinnoRA", "CinnaTropin", "Cinnal-f", "CinnoPar", "Cinnapoietin", "Temziva","Ovutropin"
)
# Assume first column is sentences
sentences <- data_1[[1]]
# Extract product name(s)
extract_products <- function(text, products) {
matches <- products[str_detect(tolower(text), tolower(products))]
if(length(matches) > 0) paste(unique(matches), collapse = ", ") else NA
}
# Extract dosage(s) (e.g., "1 mg", "50 mg", "4000 mg", etc.)
extract_dosage <- function(text) {
match <- str_extract(text, "\\b\\d+\\.?\\d*\\s?(mg|g|mcg|µg|ml|IU|units)\\b")
if(!is.na(match)) match else NA
}
# Apply functions
data_1$ProductFound <- sapply(sentences, extract_products, products=product_list)
data_1$DosageFound <- sapply(sentences, extract_dosage)
eaeu_members <- c("Armenia", "Belarus", "Kazakhstan", "Kyrgyzstan", "Russia")
# Data transformation and cleaning
data_1 <- data_1 %>%
select(ProductFound, DosageFound, Company, Country, `Registration date-Gregorian`,
`Registration date-Solar`, `Expiry date-Gregorian`, `Expiry date-Solar`,
PharmaceuticalForm, Presentation) %>%
rename(Product = ProductFound, Dosage = DosageFound) %>%
mutate(
Product = if_else(Product == "Zak Aria", "ZakAria", Product),
Product = if_else(Product == "Beta Erythropoietin", "Cinnapoietin", Product),
Product = if_else(Product == "Ovutropin", "Cinnal-f", Product),
Product = if_else(Product == "Perfacto", "AryoSeven", Product)
) %>%
filter(Company != "نانو الوند") %>%
group_by(Product, Dosage, Company, Country) %>%
arrange(`Registration date-Gregorian`) %>%
mutate(Project_Status = ifelse(row_number() == 1, "new", "re-registration")) %>%
ungroup() %>%
rename(
Registration_date_Gregorian = `Registration date-Gregorian`,
Registration_date_Solar = `Registration date-Solar`,
Expiry_date_Gregorian = `Expiry date-Gregorian`,
Expiry_date_Solar = `Expiry date-Solar`,
Medicine = Product,
Manufacturer = Company
) %>%
mutate(
Dosage = str_replace_all(Dosage, "(\\d)([A-Za-z])", "\\1 \\2"),
Manufacturer = if_else(Manufacturer == "سیناژن", "CinnaGen", "AryoGen")
) %>%
arrange(Medicine, Dosage, Manufacturer, Country, Registration_date_Gregorian) %>%
group_by(Medicine, Dosage, Manufacturer, Country) %>%
mutate(
next_registration = lead(Registration_date_Gregorian),
calculated_expiry = if_else(
!is.na(next_registration),
make_date(year(next_registration) - 1, 12, 31),
NA_Date_
),
Expiry_date_Gregorian = if_else(
is.na(Expiry_date_Gregorian),
calculated_expiry,
Expiry_date_Gregorian
)
) %>%
ungroup() %>%
select(-next_registration, -calculated_expiry) %>%
mutate(
Start = year(Registration_date_Gregorian),
Finish = year(Expiry_date_Gregorian),
Finish = if_else(is.na(Finish), year(Sys.Date()) + 2, Finish)
) %>%
mutate(Finish = ifelse(is.na(Finish), Start, Finish)) %>%
mutate(
Country = if_else(
Country == "EAEU",
paste(eaeu_members, collapse = ","),  # temporary marker
Country
)
)
data=data_1%>%
separate_rows(Country, sep = ",")%>%
rowwise() %>%
mutate(Gregorian_year = list(Start:Finish)) %>%
unnest(Gregorian_year) %>% ungroup() %>%
distinct(
Medicine,
Manufacturer,
Country,
Gregorian_year,
Dosage,
.keep_all = TRUE
)%>%
mutate(Country=if_else(Country=="Dominican Republic","Dominican",Country))
# Save locally as temporary CSV
temp_csv <- tempfile(fileext = ".csv")
write.csv(data, temp_csv, row.names = FALSE)
# Upload to Google Sheets and replace existing content
# First, get the file
sheet_file <- drive_get(as_id("13EYwvmP5uWQP_movX4vITdj8KtP6RiRi0WhNfJiXjVA"))
# Update the file with new data
drive_update(
file = sheet_file,
media = temp_csv
)
# Clean up temporary file
unlink(temp_csv)
# Save to Excel file
write_xlsx(data, "D:/Naser/Shiny & Power BI/Editted data/MA approval.xlsx")
# Save locally as temporary CSV
temp_csv <- tempfile(fileext = ".csv")
write.csv(data_1, temp_csv, row.names = FALSE)
# Upload to Google Sheets and replace existing content
# First, get the file
sheet_file <- drive_get(as_id("1q95ePu8dSSw2jq_0EC8I3iKOLJUcesyMM476eheVUn8"))
# Update the file with new data
drive_update(
file = sheet_file,
media = temp_csv
)
# Clean up temporary file
unlink(temp_csv)
d=read_sheet(SHEET_ID) %>%
mutate(Status = "With MA Approval") %>% mutate(id=1:nrow(.)) %>%
select("Medicine"
,"Dosage"
,"Manufacturer"
,"Country"
,"Registration_date_Gregorian"
,"Expiry_date_Gregorian"
,"Project_Status")
SHEET_ID <- "13EYwvmP5uWQP_movX4vITdj8KtP6RiRi0WhNfJiXjVA"
gs4_deauth()
d=read_sheet(SHEET_ID) %>%
mutate(Status = "With MA Approval") %>% mutate(id=1:nrow(.)) %>%
select("Medicine"
,"Dosage"
,"Manufacturer"
,"Country"
,"Registration_date_Gregorian"
,"Expiry_date_Gregorian"
,"Project_Status")
View(d)
d=read_sheet(SHEET_ID) %>%
mutate(Status = "With MA Approval") %>% mutate(id=1:nrow(.)) %>%
select("Medicine"
,"Dosage"
,"Manufacturer"
,"Country"
,"Registration_date_Gregorian"
,"Expiry_date_Gregorian"
,"Project_Status") %>%
distinct("Medicine"
,"Dosage"
,"Manufacturer"
,"Country"
,"Registration_date_Gregorian"
,"Expiry_date_Gregorian"
,"Project_Status")
View(d)
d=read_sheet(SHEET_ID) %>%
mutate(Status = "With MA Approval") %>% mutate(id=1:nrow(.)) %>%
select("Medicine"
,"Dosage"
,"Manufacturer"
,"Country"
,"Registration_date_Gregorian"
,"Expiry_date_Gregorian"
,"Project_Status") %>%
distinct(across(c(Medicine, Dosage, Manufacturer, Country,
Registration_date_Gregorian, Expiry_date_Gregorian,
Project_Status)))
View(d)
d$Project_Status
runApp()
runApp()
(72+72+69+74+77+78+76)*7
(72+72+69+74+77+78+76)/7
(72+72+69+74+77+77+78+76)*8
(72+72+69+74+77+77+78+76)/8
plot(c(72+72+69+74+77+77+78+76))
plot(c(72,72,69,74,77,77,78,76))
lines(c(72,72,69,74,77,77,78,76))
abline(v=74.375)
abline(H=74.375)
abline(h=74.375)
runApp()
d=read_sheet(SHEET_ID) %>%
mutate(Status = "With MA Approval") %>% mutate(id=1:nrow(.)) %>%
select("Medicine"
,"Dosage"
,"Manufacturer"
,"Country"
,"Registration_date_Gregorian"
,"Expiry_date_Gregorian"
,"Project_Status") %>%
distinct(across(c(Medicine, Dosage, Manufacturer, Country,
Registration_date_Gregorian, Expiry_date_Gregorian,
Project_Status)))
d$Project_Status
class(d$Expiry_date_Gregorian)
class(date(d$Expiry_date_Gregorian))
class(as.date(d$Expiry_date_Gregorian))
class(as.Date(d$Expiry_date_Gregorian))
class(ymd(d$Expiry_date_Gregorian))
runApp()
runApp()
# Required libraries
library(stringr)
library(readxl)
library(dplyr)
library(lubridate)
library(googledrive)
library(tidyr)
library(writexl)
# Authenticate with Google
drive_auth()
# Read your Excel file
data_1 <- read_excel("C:/Users/Ahmadina/Downloads/data.xlsx")
# List of product names
product_list <- c(
"AryoSeven", "Altebrel", "ReciGen", "CinnoVex", "Pectuna", "CinnaTropin", "Perfacto","Arylia","Zak Aria",
"Zytux", "Melitide", "AryoTrust", "Stivant", "PegaGen", "ZakAria", "CinnoMer","Beta Erythropoietin","Artenix",
"CinnoRA", "CinnaTropin", "Cinnal-f", "CinnoPar", "Cinnapoietin", "Temziva","Ovutropin"
)
# Assume first column is sentences
sentences <- data_1[[1]]
# Extract product name(s)
extract_products <- function(text, products) {
matches <- products[str_detect(tolower(text), tolower(products))]
if(length(matches) > 0) paste(unique(matches), collapse = ", ") else NA
}
# Extract dosage(s) (e.g., "1 mg", "50 mg", "4000 mg", etc.)
extract_dosage <- function(text) {
match <- str_extract(text, "\\b\\d+\\.?\\d*\\s?(mg|g|mcg|µg|ml|IU|units)\\b")
if(!is.na(match)) match else NA
}
# Apply functions
data_1$ProductFound <- sapply(sentences, extract_products, products=product_list)
data_1$DosageFound <- sapply(sentences, extract_dosage)
eaeu_members <- c("Armenia", "Belarus", "Kazakhstan", "Kyrgyzstan", "Russia")
# Data transformation and cleaning
data_1 <- data_1 %>%
select(ProductFound, DosageFound, Company, Country, `Registration date-Gregorian`,
`Registration date-Solar`, `Expiry date-Gregorian`, `Expiry date-Solar`,
PharmaceuticalForm, Presentation) %>%
rename(Product = ProductFound, Dosage = DosageFound) %>%
mutate(
Product = if_else(Product == "Zak Aria", "ZakAria", Product),
Product = if_else(Product == "Beta Erythropoietin", "Cinnapoietin", Product),
Product = if_else(Product == "Ovutropin", "Cinnal-f", Product),
Product = if_else(Product == "Perfacto", "AryoSeven", Product)
) %>%
filter(Company != "نانو الوند") %>%
group_by(Product, Dosage, Company, Country) %>%
arrange(`Registration date-Gregorian`) %>%
mutate(Project_Status = ifelse(row_number() == 1, "new", "re-registration")) %>%
ungroup() %>%
rename(
Registration_date_Gregorian = `Registration date-Gregorian`,
Registration_date_Solar = `Registration date-Solar`,
Expiry_date_Gregorian = `Expiry date-Gregorian`,
Expiry_date_Solar = `Expiry date-Solar`,
Medicine = Product,
Manufacturer = Company
) %>%
mutate(
Dosage = str_replace_all(Dosage, "(\\d)([A-Za-z])", "\\1 \\2"),
Manufacturer = if_else(Manufacturer == "سیناژن", "CinnaGen", "AryoGen")
) %>%
arrange(Medicine, Dosage, Manufacturer, Country, Registration_date_Gregorian) %>%
group_by(Medicine, Dosage, Manufacturer, Country) %>%
mutate(
next_registration = lead(Registration_date_Gregorian),
calculated_expiry = if_else(
!is.na(next_registration),
make_date(year(next_registration) - 1, 12, 31),
NA_Date_
),
Expiry_date_Gregorian = if_else(
is.na(Expiry_date_Gregorian),
calculated_expiry,
Expiry_date_Gregorian
)
) %>%
ungroup() %>%
select(-next_registration, -calculated_expiry) %>%
mutate(Expiry_date_Gregorian = ymd(paste0(year(Expiry_date_Gregorian),"-",
month(Expiry_date_Gregorian),"-",
day(Expiry_date_Gregorian))),
Start = year(Registration_date_Gregorian),
Finish = year(Expiry_date_Gregorian),
Finish = if_else(is.na(Finish), year(Sys.Date()) + 2, Finish)
) %>%
mutate(Finish = ifelse(is.na(Finish), Start, Finish)) %>%
mutate(
Country = if_else(
Country == "EAEU",
paste(eaeu_members, collapse = ","),  # temporary marker
Country
)
)
View(data_1)
# Required libraries
library(stringr)
library(readxl)
library(dplyr)
library(lubridate)
library(googledrive)
library(tidyr)
library(writexl)
# Authenticate with Google
drive_auth()
# Read your Excel file
data_1 <- read_excel("C:/Users/Ahmadina/Downloads/data.xlsx")
# List of product names
product_list <- c(
"AryoSeven", "Altebrel", "ReciGen", "CinnoVex", "Pectuna", "CinnaTropin", "Perfacto","Arylia","Zak Aria",
"Zytux", "Melitide", "AryoTrust", "Stivant", "PegaGen", "ZakAria", "CinnoMer","Beta Erythropoietin","Artenix",
"CinnoRA", "CinnaTropin", "Cinnal-f", "CinnoPar", "Cinnapoietin", "Temziva","Ovutropin"
)
# Assume first column is sentences
sentences <- data_1[[1]]
# Extract product name(s)
extract_products <- function(text, products) {
matches <- products[str_detect(tolower(text), tolower(products))]
if(length(matches) > 0) paste(unique(matches), collapse = ", ") else NA
}
# Extract dosage(s) (e.g., "1 mg", "50 mg", "4000 mg", etc.)
extract_dosage <- function(text) {
match <- str_extract(text, "\\b\\d+\\.?\\d*\\s?(mg|g|mcg|µg|ml|IU|units)\\b")
if(!is.na(match)) match else NA
}
# Apply functions
data_1$ProductFound <- sapply(sentences, extract_products, products=product_list)
data_1$DosageFound <- sapply(sentences, extract_dosage)
eaeu_members <- c("Armenia", "Belarus", "Kazakhstan", "Kyrgyzstan", "Russia")
# Data transformation and cleaning
data_1 <- data_1 %>%
select(ProductFound, DosageFound, Company, Country, `Registration date-Gregorian`,
`Registration date-Solar`, `Expiry date-Gregorian`, `Expiry date-Solar`,
PharmaceuticalForm, Presentation) %>%
rename(Product = ProductFound, Dosage = DosageFound) %>%
mutate(
Product = if_else(Product == "Zak Aria", "ZakAria", Product),
Product = if_else(Product == "Beta Erythropoietin", "Cinnapoietin", Product),
Product = if_else(Product == "Ovutropin", "Cinnal-f", Product),
Product = if_else(Product == "Perfacto", "AryoSeven", Product)
) %>%
filter(Company != "نانو الوند") %>%
group_by(Product, Dosage, Company, Country) %>%
arrange(`Registration date-Gregorian`) %>%
mutate(Project_Status = ifelse(row_number() == 1, "new", "re-registration")) %>%
ungroup() %>%
rename(
Registration_date_Gregorian = `Registration date-Gregorian`,
Registration_date_Solar = `Registration date-Solar`,
Expiry_date_Gregorian = `Expiry date-Gregorian`,
Expiry_date_Solar = `Expiry date-Solar`,
Medicine = Product,
Manufacturer = Company
) %>%
mutate(
Dosage = str_replace_all(Dosage, "(\\d)([A-Za-z])", "\\1 \\2"),
Manufacturer = if_else(Manufacturer == "سیناژن", "CinnaGen", "AryoGen")
) %>%
arrange(Medicine, Dosage, Manufacturer, Country, Registration_date_Gregorian) %>%
group_by(Medicine, Dosage, Manufacturer, Country) %>%
mutate(
next_registration = lead(Registration_date_Gregorian),
calculated_expiry = if_else(
!is.na(next_registration),
make_date(year(next_registration) - 1, 12, 31),
NA_Date_
),
Expiry_date_Gregorian = if_else(
is.na(Expiry_date_Gregorian),
calculated_expiry,
Expiry_date_Gregorian
)
) %>%
ungroup() %>%
select(-next_registration, -calculated_expiry) %>%
mutate(Expiry_date_Gregorian = ymd(paste0(year(Expiry_date_Gregorian),"-",
month(Expiry_date_Gregorian),"-",
day(Expiry_date_Gregorian))),
Registration_date_Gregorian = ymd(paste0(year(Registration_date_Gregorian),"-",
month(Registration_date_Gregorian),"-",
day(Registration_date_Gregorian))),
Expiration_status = if_else(Expiry_date_Gregorian < today(),
"Expired", "Not expired"),
Start = year(Registration_date_Gregorian),
Finish = year(Expiry_date_Gregorian),
Finish = if_else(is.na(Finish), year(Sys.Date()) + 2, Finish)
) %>%
mutate(Finish = ifelse(is.na(Finish), Start, Finish)) %>%
mutate(
Country = if_else(
Country == "EAEU",
paste(eaeu_members, collapse = ","),  # temporary marker
Country
)
)
data=data_1%>%
separate_rows(Country, sep = ",")%>%
rowwise() %>%
mutate(Gregorian_year = list(Start:Finish)) %>%
unnest(Gregorian_year) %>% ungroup() %>%
distinct(
Medicine,
Manufacturer,
Country,
Gregorian_year,
Dosage,
.keep_all = TRUE
)%>%
mutate(Country=if_else(Country=="Dominican Republic","Dominican",Country))
# Save locally as temporary CSV
temp_csv <- tempfile(fileext = ".csv")
write.csv(data, temp_csv, row.names = FALSE)
# Upload to Google Sheets and replace existing content
# First, get the file
sheet_file <- drive_get(as_id("13EYwvmP5uWQP_movX4vITdj8KtP6RiRi0WhNfJiXjVA"))
# Update the file with new data
drive_update(
file = sheet_file,
media = temp_csv
)
# Clean up temporary file
unlink(temp_csv)
# Save to Excel file
write_xlsx(data, "D:/Naser/Shiny & Power BI/Editted data/MA approval.xlsx")
runApp()
runApp()
shiny::runApp()
shiny::runApp()
shiny::runApp()
